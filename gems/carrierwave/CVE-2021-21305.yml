---
gem: carrierwave
cve: 2021-21305
ghsa: cf3w-g86h-35x4
url: https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-cf3w-g86h-35x4
date: 2021-02-08
title: Code Injection vulnerability in CarrierWave::RMagick
description: |-
  ### Impact
  [CarrierWave::RMagick](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/processing/rmagick.rb)
  has a Code Injection vulnerability. Its `#manipulate!` method inappropriately evals the content of mutation
  option(`:read`/`:write`), allowing attackers to craft a string that can be executed as a Ruby code.
  If an application developer supplies untrusted inputs to the option, it will lead to remote code execution(RCE).

  (But supplying untrusted input to the option itself is dangerous even in absence of this vulnerability, since is prone to
  DoS vulnerability - attackers can try to consume massive amounts of memory by resizing to a very large dimension)

  ### Proof of Concept
  ```ruby
  class MyUploader < CarrierWave::Uploader::Base
    include CarrierWave::RMagick
  end

  MyUploader.new.manipulate!({ read: { density: "1 }; p 'Hacked'; {" }}) # => shows "Hacked"
  ```

  ### Patches
  Upgrade to [2.1.1](https://rubygems.org/gems/carrierwave/versions/2.1.1) or
  [1.3.2](https://rubygems.org/gems/carrierwave/versions/1.3.2).

  ### Workarounds
  Stop supplying untrusted input to `#manipulate!`'s mutation option.
cvss_v3: 7.4
patched_versions:
- ~> 1.3.2
- '>= 2.1.1'
